## 预览地址  
[pan.mxin.ltd](https://pan.mxin.ltd/)
##毫秒级响应,纵然他前后端没有分离.  
##服务器客户端双重缓存策略.  
##缓存策略精细到文件夹,避免频繁调用api.  
##特色文件管理,如同我的电脑一样轻松复制粘贴.  
##特色网络防火墙功能,避免房子丢了.
##内置api无需填写申请.  
##开源免费想怎么改怎么改不触犯法律(某翼触犯法律作者疑跑路)  
##无需什么scf hreko 又卡又慢,一不小心被攻击了房子都没了.
##低成本 拒绝高昂oss cos 等天价存储.
##无需cdn 前端资源使用强大的微软jsdevli 每次访问只需要几kb流量,无聊刷新也有客户端缓存  
##壁纸随心换.  
##支持主题扩展.
##支持命令行模式
##支持webdav扩展   



其他说明

1.nginx伪静态
```
if (!-f $request_filename){
set $rule_0 1$rule_0;
}
if (!-d $request_filename){
set $rule_0 2$rule_0;
}
if ($rule_0 = "21"){
rewrite ^/(.*)$ /index.php/$1 last;
}
```

# oneindex
OneDrive Directory Index

## 功能：
不用服务器空间，不走服务器流量，  

直接列onedrive目录，文件直链下载。  



## 创意整合
1.极大简化安装步骤,免创建api。           
2.一些样式美化修改。         
3.分页模式，加快页面预览速度。    
4.可后台自定义网站主标题,副标题。         
5.可后台自定义每页显示项目数量。          
6.支持shrapoint.  
7.多盘模式.  
8.qq互联管理员登陆避免跨站.  
## 重新安装
删除 oneindex/config 下的所有文件即可.                
              

## change log:
猫 大🐾  09:49:59 左侧应用栏开关,  
0703--解决文件夹post  
解决文件管理模式,客户端304导致无法移动文件  
右键增移动文件,粘贴文件  
解决移动文件后旧目录依旧显示bug  
增加游客随意上传文件(不能编辑替换)    
0702--
增加指定目录上传  
增加背景图片设置  
增加是否渲染md   
增加个小型论坛系统  
增加是否开放游客浏览  
增加多盘初始目录  
增加高级缓存配置  
增加前后端分离api  
增加是否启用oauth登陆管理员  
增加会员权限系统  
增加304响应，减少服务器压力 
优化响应速度  
增加防火墙防止一夜房子没了  
合并多余js  
优化权限控制  
重写文件管理api 和js  
移除jquery  
移除layer  
修复上传按钮挡出音乐播放器  
增加文件复制粘贴功能  
右键菜单增加单文件移动复制功能
右键菜单增加粘贴按钮  
20-06-30  优化代码,增加客户端缓存节约流量    
20-06-24  背景更换    
20-06-23  增加离线下载    
20-06-17  管理员模式不使用缓存  
20-06-17  增加并发删除移动api  
20-06-16  优化上传    
20-06-14  文件批量移动功能(debug)  
20-06-13  文件批量删除(debug)  
20-06-12  增加主题背景  
20-06-09  增加新建文件夹功能  
20-06-07  文件管理/删除/重命名  
20-06=07  修复md文件全屏  
20-06=07  修复加密文件夹无法验证密码  
20-06=06  增加重命名文件方法  
20-06=06  增加删除文件方法  
20-06=06  修复重建缓存  
20-06-05 cli 功能增加列表 删除文件创建文件夹  
20-06-05 修复cli上传模式并且支持多盘/sharepoint  
20-06-05   修复多盘引起图床失效  
20-06-05   bug 重建缓存失效(文件过多导致炸了api,考虑是否弃用)  
20—06-02: 添加侧边栏网盘导航  
20-06-01: 修复首页空白问题  
20-05-29: 增加sharepoint站点id自动获取工具,账户显示,空间显示.
20-05-24: 移除cli模式  
20-05-25: 完成自动配置  
20-05-24: 完成多盘配置  
20-05-21: 添加防盗链接  
20-05-20: 移除pdfjs  
20-05-19: 静态资源cdn 使用jsdevil  
18-03-29: 更新直链获取机制、缓存机制，避免频繁访问的token失效  
18-03-29: 解决非英文编码问题  
18-03-29: 添加onedrive共享的起始目录 功能  
18-03-29: 添加rewrite的配置文件  
18-03-29: 增加sqlite模式cache支持  
18-03-29: 添加缩略图功能  
18-03-29: 添加404判断  
18-03-31: 添加console  
18-04-13: 修复特殊文件名无法下载问题  
18-04-13: 添加命令行上传功能  
18-04-16: 更新 2.0 beta  
18-04-16: 更新展示界面  
18-04-16: 响应式，支持小屏设备  
18-04-16: 图片在线预览  
18-04-16: 视频在线播放  
18-04-16: 代码在线查看（js、css、html、sh、php、java、md等）  
18-04-16: README.md 支持，解析各目录下(onedirive目录下) README.md 文件，在页面尾部展示。  
18-04-18: 音频在线播放  
18-04-18: HEAD.md 支持，在页面头部展示   
18-04-18: .password 文件夹加密  
18-05-06: 在线视频播放器替换成 Dplayer  
18-05-06: 在线视频播放支持'mp4','webm','avi','mpg', 'mpeg', 'rm', 'rmvb', 'mov', 'wmv', 'mkv', 'asf'  
18-06-01: 支持个人账号  
18-06-01: cli文件夹上传（单线程）  
18-06-01: 管理后台(后台地址:?/admin 默认密码:oneindex)  
18-06-01: 不同后缀展示设置  
18-06-01: 文件直接输出  
18-06-01: 文件上传管理（后台） 
18-06-01: 增加index.html特性   
18-06-01: 图床功能   

## 需求：
1、PHP空间，PHP 7.0+ 打开curl支持  
2、onedrive 账号 (个人、企业版或教育版/工作或学校帐户)  
3、oneindex 程序   

## 安装：



## 计划任务  
[可选]**推荐配置**，非必需。后台定时刷新缓存，可增加前台访问的速度  
```
# 每小时刷新一次token
0 * * * * /具体路径/php /程序具体路径/one.php token:refresh

# 每十分钟后台刷新一遍缓存
*/10 * * * * /具体路径/php /程序具体路径/one.php cache:refresh
```

## 特殊文件实现功能  
` README.md `、`HEAD.md` 、 `.password`特殊文件使用  

可以参考[https://github.com/0oVicero0/oneindex/tree/files](https://github.com/0oVicero0/oneindex/tree/files)  

**在文件夹底部添加说明:**  
>在onedrive的文件夹中添加` README.md `文件，使用markdown语法。  

**在文件夹头部添加说明:**  
>在onedrive的文件夹中添加`HEAD.md` 文件，使用markdown语法。  

**加密文件夹:**  
>在onedrive的文件夹中添加`.password`文件，填入密码，密码不能为空。  

**直接输出网页:**  
>在onedrive的文件夹中添加`index.html` 文件，程序会直接输出网页而不列目录。  
>配合 文件展示设置-直接输出 效果更佳  

## 命令行功能  
仅能在php cli模式下运行  
**清除缓存:**  
```
php one.php cache:clear
```
**刷新缓存:**  
```
php one.php cache:refresh
```
**刷新令牌:**  
```
php one.php token:refresh
```
**上传文件:**  
```
php one.php upload:file 本地文件 远程路径 驱动器
```
